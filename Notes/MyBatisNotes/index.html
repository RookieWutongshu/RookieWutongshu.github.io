<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="RookieWutongshu">
  <link rel="shortcut icon" href="../../favicon.ico">
  
  <title>MyBatisNotes - Welcome to RookieWutongshu's Blog</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "MyBatisNotes";
    var mkdocs_page_input_path = "Notes\\MyBatisNotes.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Welcome to RookieWutongshu's Blog</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Notes Navigation</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../SQLNotes/">SQLNotes</a>
                </li>
                <li class="">
                    
    <a class="" href="../EnglishNotes/">EnglishNotes</a>
                </li>
                <li class="">
                    
    <a class="" href="../spring/">SpringNotes</a>
                </li>
                <li class="">
                    
    <a class="" href="../SpringMvc/">SpringMVCNotes</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">MyBatisNotes</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#mybatisnotes">MyBatisNotes</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#basic-config">Basic config</a></li>
        
            <li><a class="toctree-l4" href="#configtration-xml">Configtration XML</a></li>
        
            <li><a class="toctree-l4" href="#acquiring-a-sqlseesion-from-sqlsessionfactory">Acquiring(获取) a SqlSeesion from SqlSessionFactory</a></li>
        
            <li><a class="toctree-l4" href="#exploring-mapped-sql-statements">Exploring Mapped SQL Statements</a></li>
        
            <li><a class="toctree-l4" href="#scope-and-lifecycle">Scope and Lifecycle(生命周期)</a></li>
        
            <li><a class="toctree-l4" href="#when-your-javabean-property-name-is-different-from-the-field-in-the-table">When your javabean property name is different from the field in the table</a></li>
        
            <li><a class="toctree-l4" href="#difference-between-and">Difference between $ and</a></li>
        
            <li><a class="toctree-l4" href="#realize-not-case-sensitive">realize not case sensitive(大小写敏感)</a></li>
        
            <li><a class="toctree-l4" href="#transmit-multi-parameters-to-mapperxml">Transmit multi parameters to mapper.xml</a></li>
        
            <li><a class="toctree-l4" href="#insert">Insert</a></li>
        
            <li><a class="toctree-l4" href="#update">Update</a></li>
        
            <li><a class="toctree-l4" href="#some-question-i-have-met">Some Question I have met</a></li>
        
            <li><a class="toctree-l4" href="#refers">Refers</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../MySQL Notes/">MysqlNote</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Others</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../Others/Questions/">Questions</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Welcome to RookieWutongshu's Blog</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Notes Navigation &raquo;</li>
        
      
    
    <li>MyBatisNotes</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="mybatisnotes">MyBatisNotes</h1>
<div class="toc">
<ul>
<li><a href="#mybatisnotes">MyBatisNotes</a><ul>
<li><a href="#basic-config">Basic config</a><ul>
<li><a href="#maven-dependency">Maven dependency</a></li>
<li><a href="#springmvc-config">springmvc-config</a></li>
<li><a href="#deploy-log4j">Deploy Log4j</a></li>
</ul>
</li>
<li><a href="#configtration-xml">Configtration XML</a><ul>
<li><a href="#typealiases">typeAliases</a></li>
</ul>
</li>
<li><a href="#acquiring-a-sqlseesion-from-sqlsessionfactory">Acquiring(获取) a SqlSeesion from SqlSessionFactory</a></li>
<li><a href="#exploring-mapped-sql-statements">Exploring Mapped SQL Statements</a></li>
<li><a href="#scope-and-lifecycle">Scope and Lifecycle(生命周期)</a></li>
<li><a href="#when-your-javabean-property-name-is-different-from-the-field-in-the-table">When your javabean property name is different from the field in the table</a></li>
<li><a href="#difference-between-and">Difference between $ and</a></li>
<li><a href="#realize-not-case-sensitive">realize not case sensitive(大小写敏感)</a></li>
<li><a href="#transmit-multi-parameters-to-mapperxml">Transmit multi parameters to mapper.xml</a></li>
<li><a href="#insert">Insert</a></li>
<li><a href="#update">Update</a></li>
<li><a href="#some-question-i-have-met">Some Question I have met</a></li>
<li><a href="#refers">Refers</a></li>
</ul>
</li>
</ul>
</div>
<h2 id="basic-config">Basic config</h2>
<h3 id="maven-dependency">Maven dependency</h3>
<pre><code class="xml">    &lt;!--mybatis--&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.mybatis&lt;/groupId&gt;
      &lt;artifactId&gt;mybatis&lt;/artifactId&gt;
      &lt;version&gt;${mybatis.version}&lt;/version&gt;
    &lt;/dependency&gt;

    &lt;!--MyBatis Generator --&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.mybatis.generator&lt;/groupId&gt;
      &lt;artifactId&gt;mybatis-generator-core&lt;/artifactId&gt;
      &lt;version&gt;1.3.5&lt;/version&gt;
    &lt;/dependency&gt;

    &lt;!--日志处理,mabatis 默认用这个，带log4j--&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.slf4j&lt;/groupId&gt;
      &lt;artifactId&gt;slf4j-log4j12&lt;/artifactId&gt;
      &lt;version&gt;1.7.25&lt;/version&gt;
    &lt;/dependency&gt;

    &lt;!--Mysql--&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;mysql&lt;/groupId&gt;
      &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
      &lt;version&gt;8.0.11&lt;/version&gt;
    &lt;/dependency&gt;

    &lt;!--Mybatis spring插件--&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.mybatis&lt;/groupId&gt;
      &lt;artifactId&gt;mybatis-spring&lt;/artifactId&gt;
      &lt;version&gt;1.2.2&lt;/version&gt;
    &lt;/dependency&gt;
</code></pre>

<h3 id="springmvc-config">springmvc-config</h3>
<pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;!DOCTYPE configuration
        PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot;
        &quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;
&lt;configuration&gt;

    &lt;!--引入数据库连接配置--&gt;
    &lt;properties resource=&quot;db.properties&quot; /&gt;

    &lt;!-- 定义数据源--&gt;
    &lt;environments default=&quot;development&quot;&gt;
        &lt;environment id=&quot;development&quot;&gt;
            &lt;transactionManager type=&quot;JDBC&quot;/&gt;
            &lt;dataSource type=&quot;POOLED&quot;&gt;
                &lt;property name=&quot;driver&quot; value=&quot;${jdbc.driver}&quot;/&gt;
                &lt;property name=&quot;url&quot; value=&quot;${jdbc.url}&quot;/&gt;
                &lt;property name=&quot;username&quot; value=&quot;${jdbc.username}&quot;/&gt;
                &lt;property name=&quot;password&quot; value=&quot;${jdbc.password}&quot;/&gt;
            &lt;/dataSource&gt;
        &lt;/environment&gt;
        &lt;!--&lt;environment id=&quot;test&quot;&gt;--&gt;
        &lt;!--&lt;/environment&gt;--&gt;
        &lt;!--&lt;environment id=&quot;production&quot;&gt;--&gt;
        &lt;!--&lt;/environment&gt;--&gt;
    &lt;/environments&gt;
    &lt;mappers&gt;
        &lt;!--&lt;mapper resource=&quot;org/mybatis/example/BlogMapper.xml&quot;/&gt;--&gt;
        &lt;package name=&quot;com.mapper&quot; /&gt;
    &lt;/mappers&gt;
&lt;/configuration&gt;
</code></pre>

<pre><code>jdbc.driver=com.mysql.jdbc.Driver
jdbc.url=jdbc:mysql://localhost:3306/test
jdbc.username=root
jdbc.password=123456
</code></pre>

<h3 id="deploy-log4j">Deploy Log4j</h3>
<p>New a log4j.properties file.</p>
<pre><code># Global logging configuration
log4j.rootLogger=ERROR, stdout
# MyBatis logging configuration...
log4j.logger.org.mybatis.example.BlogMapper=TRACE
# Console output...
log4j.appender.stdout=org.apache.log4j.ConsoleAppender
log4j.appender.stdout.layout=org.apache.log4j.PatternLayout
log4j.appender.stdout.layout.ConversionPattern=%5p [%t] - %m%n
</code></pre>

<p>If you want to tune(调整) the logging at a finer level you can turn logging on for specific statements instead of the whole mapper file. </p>
<p><code>log4j.logger.org.mybatis.example.BlogMapper.selectBlog=TRACE</code></p>
<p>By the contrary you may want want to enable logging for a group of mappers.</p>
<p><code>log4j.logger.org.mybatis.example=TRACE</code></p>
<p>There are queries that can return huge result sets. In that cases you may want to see the SQL statement but not the results. For that purpose SQL statements are logged at the DEBUG level </p>
<p><code>log4j.logger.org.mybatis.example=DEBUG</code></p>
<h2 id="configtration-xml">Configtration XML</h2>
<h3 id="typealiases">typeAliases</h3>
<p>A type alias is simply a shorter name for a Java type. It's only relevant to the XML configuration and simply exists to reduce redundant typing of fully qualified classnames</p>
<pre><code class="xml">&lt;typeAliases&gt;
  &lt;typeAlias alias=&quot;Author&quot; type=&quot;domain.blog.Author&quot;/&gt;
&lt;/typeAliases&gt;
</code></pre>

<p>With this configuration, <code>Blog</code> can now be used anywhere that <code>domain.blog.Blog</code> could be.</p>
<p>You can also specify a package where MyBatis will search for beans. </p>
<pre><code class="xml">&lt;typeAliases&gt;
  &lt;package name=&quot;domain.blog&quot;/&gt;
&lt;/typeAliases&gt;
</code></pre>

<p>Each bean found in <code>domain.blog</code> , if no annotation is found, will be registered as an alias using uncapitalized non-qualified class name of the bean. That is<code>domain.blog.Author</code> will be registered as <code>author</code>. If the <code>@Alias</code> annotation is found its value will be used as an alias. See the example below</p>
<pre><code class="java">@Alias(&quot;author&quot;)
public class Author {
    ...
}
</code></pre>

<h2 id="acquiring-a-sqlseesion-from-sqlsessionfactory">Acquiring(获取) a SqlSeesion from SqlSessionFactory</h2>
<p>you can acquire an instance of SqlSession. The SqlSession contains absolutely every method needed to execute SQL commands against the database. You can execute mapped SQL statements directly against the SqlSession instance. For example:</p>
<pre><code class="java">SqlSession session = sqlSessionFactory.openSession();
try {
  Blog blog = session.selectOne(
    &quot;org.mybatis.example.BlogMapper.selectBlog&quot;, 101);
} finally {
  session.close();
}
</code></pre>

<p>there is now a cleaner approach(方法). Using an <strong>interface</strong> (e.g. BlogMapper.class) that properly describes the parameter and return value for a given statement, you can now execute cleaner and more <strong>type safe</strong> code, without error prone(容易出错) string literals and casting.</p>
<pre><code class="java">SqlSession session = sqlSessionFactory.openSession();
try {
  BlogMapper mapper = session.getMapper(BlogMapper.class);
  Blog blog = mapper.selectBlog(101);
} finally {
  session.close();
}
</code></pre>

<h2 id="exploring-mapped-sql-statements">Exploring Mapped SQL Statements</h2>
<p>In either of the examples above, the statements could have been defined by either XML or Annotations. Let's take a look at XML first.</p>
<pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;!DOCTYPE mapper
  PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;
  &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;
&lt;mapper namespace=&quot;org.mybatis.example.BlogMapper&quot;&gt;
  &lt;select id=&quot;selectBlog&quot; resultType=&quot;Blog&quot;&gt;
    select * from Blog where id = #{id}
  &lt;/select&gt;
&lt;/mapper&gt;
</code></pre>

<blockquote>
<p><strong>Note:</strong> <strong>A note about namespaces</strong></p>
<p><strong>Namespaces</strong> were optional in previous versions of MyBatis, which was confusing and unhelpful. Namespaces are now <strong>required</strong> and have a purpose (1)beyond simply isolating(孤立) statements with longer, fully-qualified names.(2)Namespaces enable the interface bindings as you see here, and even if you don’t think you’ll use them today,</p>
</blockquote>
<p>There's one more trick to Mapper classes like BlogMapper. Their mapped statements don't need to be mapped with XML at all. Instead they can use Java Annotations. For example,</p>
<pre><code class="java">public interface BlogMapper {
  @Select(&quot;SELECT * FROM blog WHERE id = #{id}&quot;)
  Blog selectBlog(int id);
}
</code></pre>

<p>However, Java Annotations are both limited and messier for more complicated statements. Therefore, if you have to do anything complicated, you're better off with XML mapped statements.</p>
<h2 id="scope-and-lifecycle">Scope and Lifecycle(生命周期)</h2>
<p>It's very important to understand the various scopes and lifecycles classes we've discussed so far. Using them incorrectly can cause severe concurrency(并发) problems.</p>
<blockquote>
<p><strong>NOTE</strong> <strong>Object lifecycle and Dependency Injection Frameworks</strong></p>
<p>Dependency Injection frameworks can create thread safe, transactional SqlSessions and mappers and inject them directly into your beans so you can just forget about their lifecycle. You may want to have a look at MyBatis-Spring or MyBatis-Guice sub-projects to know more about using MyBatis with DI frameworks.</p>
</blockquote>
<p><strong>SqlSessionFactoryBuilder</strong></p>
<p>There is no need to keep it around once you've created your SqlSessionFactory. Therefore the best scope for instances of SqlSessionFactoryBuilder is method scope</p>
<p><strong>SqlSessionFactory</strong></p>
<p>Once created, the SqlSessionFactory should exist for the duration of your application execution. There should be little or no reason to ever dispose of it or recreate it.Therefore the best scope of SqlSessionFactory is application scope. This can be achieved a number of ways. The simplest is to use a Singleton pattern or Static Singleton pattern.</p>
<p><strong>SQLSession</strong></p>
<p>Each thread should have its own instance of SqlSession. Instances of SqlSession are not to be shared and are not thread safe. Therefore the best scope is request or method scope. Never keep references to a SqlSession instance in a static field or even an instance field of a class. Never keep references to a SqlSession in any sort of managed scope(托管作用域), such as HttpSession of the Servlet framework. If you're using a web framework of any sort, consider the SqlSession to follow a similar scope to that of an HTTP request.</p>
<pre><code class="java">SqlSession session = sqlSessionFactory.openSession();
try {
  // do work
} finally {
  session.close();
}
</code></pre>

<p><strong>Mapper Instances</strong></p>
<p>Mappers are interfaces that you create to bind to your mapped statements. Instances of the mapper interfaces are acquired from the SqlSession. As such, technically the broadest scope of any mapper instance is the same as the SqlSession from which they were requested.However, the best scope for mapper instances is method scope. While it's not a problem to keep them around throughout a request, similar to the SqlSession, you might find that managing too many resources at this level will quickly get out of hand. </p>
<h2 id="when-your-javabean-property-name-is-different-from-the-field-in-the-table">When your javabean property name is different from the field in the table</h2>
<ol>
<li>Use alias in SQL statement,such as</li>
</ol>
<pre><code class="xml">&lt;select id = &quot;selectById&quot; parameterType = &quot;Integer&quot; returnType=&quot;User&quot;&gt;
    select 'user_id' as userID,'username','password' from 'User' where userID = #{id}
&lt;/select&gt;
</code></pre>

<ol>
<li>use a <code>&lt;ResultMap&gt;</code></li>
</ol>
<pre><code class="xml">&lt;resultMap type=&quot;Blog&quot; id=&quot;BlogResultMap&quot;&gt;
    &lt;id column=&quot;id&quot; property=&quot;id&quot; jdbcType=&quot;Interger&quot;&gt;
    &lt;result column=&quot;author_id&quot; property=&quot;authorID&quot; jdbcType=&quot;INTEGER&quot; /&gt;
&lt;/resultMap&gt;
&lt;select id = &quot;selectById&quot; parameterType = &quot;Integer&quot; resultMap=&quot;UserResultMap&quot;&gt;
    select * from 'Blog' where authorID = #{id}
&lt;/select&gt;
</code></pre>

<p>Of course, if you use mybatis generator you won't  meet this question QAQ.</p>
<h2 id="difference-between-and">Difference between $ and</h2>
<p><strong>Configuration properties</strong></p>
<p>For example:</p>
<pre><code class="xml">&lt;properties resource=&quot;org/mybatis/example/config.properties&quot;&gt;
  &lt;property name=&quot;username&quot; value=&quot;dev_user&quot;/&gt;
  &lt;property name=&quot;password&quot; value=&quot;F2Fa3!33TYyg&quot;/&gt;
&lt;/properties&gt; 
</code></pre>

<p>Then the properties can be used like next:</p>
<pre><code class="xml">&lt;dataSource type=&quot;POOLED&quot;&gt;
  &lt;property name=&quot;username&quot; value=&quot;${username}&quot;/&gt;
  &lt;property name=&quot;password&quot; value=&quot;${password}&quot;/&gt;
&lt;/dataSource&gt;
</code></pre>

<p><strong>String Substitution</strong>(替换)</p>
<p>By default, using the <code>#{}</code> syntax will cause MyBatis to generate <code>PreparedStatement</code> properties and set the values safely against the <code>PreparedStatement</code> parameters (e.g. ?). While this is safer, faster and almost always preferred, sometimes you just want to directly inject an unmodified string into the SQL Statement. For example, for ORDER BY, you might use something like this:</p>
<pre><code>ORDER BY ${columnName}
</code></pre>

<p>Here MyBatis won't modify or escape the string.（修改或转义字符串）</p>
<p>String Substitution can be very useful when the metadata(i.e. table name or column name) in the sql statement is dynamic, for example, if you want to <code>select</code> from a table by any one of its columns, instead of writing code like:</p>
<pre><code class="java">@Select(&quot;select * from user where id = #{id}&quot;)
User findById(@Param(&quot;id&quot;) long id);

@Select(&quot;select * from user where name = #{name}&quot;)
User findByName(@Param(&quot;name&quot;) String name);

@Select(&quot;select * from user where email = #{email}&quot;)
User findByEmail(@Param(&quot;email&quot;) String email);

// and more &quot;findByXxx&quot; method
</code></pre>

<p>you can just write:</p>
<pre><code class="java">@Select(&quot;select * from user where ${column} = #{value}&quot;)
User findByColumn(@Param(&quot;column&quot;) String column, @Param(&quot;value&quot;) String value);
</code></pre>

<p>Note that if you do not specify param name with @Param annotation, and your param is a single type and only one params. You should write ${value} instead of ${parammeterName}. If the params in $ is a String, you should add ' ' between ${value}</p>
<pre><code class="xml">&lt;select id=&quot;select1&quot; resultMap=&quot;BaseResultMap&quot; parameterType=&quot;string&quot;&gt;
    select * from Student where username like #{name}
&lt;/select&gt;
&lt;select id=&quot;select2&quot; resultMap=&quot;BaseResultMap&quot; parameterType=&quot;string&quot;&gt;
    select * from Student where username like '%${value}%'
&lt;/select&gt;
</code></pre>

<p>Or write as</p>
<pre><code class="java">List&lt;Student&gt; list = mapper.select2(&quot;'%root%'&quot;);
//if you use #
List&lt;Student&gt; list = mapper.select1(&quot;%root%&quot;);
</code></pre>

<p>Summary(总结)，# is placeholder(占位符) ?, $ is String concatenation(字符串拼接); If the params is a String should add ' '; When you use paras means column you should use $.</p>
<h2 id="realize-not-case-sensitive">realize not case sensitive(大小写敏感)</h2>
<p>just upper or lower the select condition, the follwing sql function are used in mysql</p>
<pre><code class="xml">&lt;select id=&quot;select2&quot; resultMap=&quot;BaseResultMap&quot; parameterType=&quot;string&quot;&gt;
    select * from Student where lower(username) like lower('%${value}%')
&lt;/select&gt;
</code></pre>

<p>or</p>
<pre><code class="sql">select * from user where username like binary('admin') and password like binary('admin');
</code></pre>

<p>Sometimes some database will not case sensitive by default, such as MySQL, you can check your database first.</p>
<p>## Order Chinese charactors</p>
<p>Use convert function to convert the coding into gbk.</p>
<p>In MySQL, you can use </p>
<p>CAST(expr AS type), CONVERT(expr,type) , CONVERT(expr USING transcoding_name).</p>
<pre><code class="sql">select * from user order by CONVERT(username USING GBK);
</code></pre>

<h2 id="transmit-multi-parameters-to-mapperxml">Transmit multi parameters to mapper.xml</h2>
<p>There are three way to realize it.</p>
<ol>
<li>use index</li>
<li>use @Param annotation, the params value should as the same as spaceholder params in the mapper.xml</li>
<li>use a map.The key in map should as the same as spaceholder params in the mapper.xml</li>
</ol>
<pre><code class="xml">&lt;select id = &quot;select1&quot; reesultMap = &quot;BaseMap&quot;&gt;
    select * from User limit #{1}, #{2}
&lt;/select&gt;
&lt;select id = &quot;select2&quot; reesultMap = &quot;BaseMap&quot;&gt;
    select * from User limit #{offset}, #{pagesize}
&lt;/select&gt;
&lt;select id = &quot;select3&quot; reesultMap = &quot;BaseMap&quot;&gt;
    select * from User limit #{offset}, #{pagesize}
&lt;/select&gt;
</code></pre>

<pre><code class="java">// method2 in mapper file
List&lt;User&gt; select2(@Param(value=&quot;offset&quot;)offset,@Param(value=&quot;pagesize&quot;) pagesize);

//method3 in mapper file
List&lt;User&gt; select2(Map&lt;String,object&gt; map);

//method3 when use interface
HashMap&lt;String,object&gt; map = new HashMap&lt;String,Object&gt;();
map.put(&quot;offset&quot;,2);
map.put(&quot;pagesize&quot;,2);
</code></pre>

<h2 id="insert">Insert</h2>
<p>As mentioned, insert is a little bit more rich in that it has a few extra attributes and sub-elements that allow it to deal with key generation in a number of ways.</p>
<p>First, if your database supports auto-generated key fields (e.g. MySQL and SQL Server), then you can simply set <code>useGeneratedKeys="true"</code> and set the <code>keyProperty</code> to the target property and you're done. For example, if the <code>Author</code> table above had used an auto-generated column type for the id, the statement would be modified as follows:</p>
<pre><code class="xml">&lt;insert id=&quot;insertAuthor&quot; useGeneratedKeys=&quot;true&quot;
    keyProperty=&quot;id&quot;&gt;
  insert into Author (username,password,email,bio)
  values (#{username},#{password},#{email},#{bio})
&lt;/insert&gt;
</code></pre>

<p>The useGeneratedKey can be setted in the mybatis  config file too.</p>
<pre><code class="xml">&lt;settings&gt;
    &lt;setting name = &quot;useGeneratedKeys&quot; value =&quot;true&quot;/&gt;
&lt;/settings&gt;
</code></pre>

<p>MyBatis has another way to deal with key generation for <strong>databases that don't support auto-generated column types, </strong>or perhaps don't yet support the JDBC driver support for auto-generated keys.</p>
<p>Note that the keyProperty is the name of bean property.</p>
<pre><code class="xml">&lt;insert id=&quot;insertAuthor&quot;&gt;
  &lt;selectKey keyProperty=&quot;id&quot; resultType=&quot;int&quot; order=&quot;BEFORE&quot;&gt;
    &lt;!--select CAST(RANDOM()*1000000 as INTEGER) a from SYSIBM.SYSDUMMY1 --&gt;
    &lt;!--the follwing sql is used in oracle --&gt;
    select seq.nextval as id from dual
  &lt;/selectKey&gt;
  insert into Author
    (id, username, password, email,bio, favourite_section)
  values
    (#{id}, #{username}, #{password}, #{email}, #{bio}, #{favouriteSection,jdbcType=VARCHAR})
&lt;/insert&gt;

&lt;insert id=&quot;insert1&quot; &gt;
          &lt;selectKey keyProperty=&quot;userId&quot; resultType=&quot;java.lang.Integer&quot; order=&quot;AFTER&quot;&gt;
              &lt;!--the follwing sql is used in MySQL --&gt;
            select LAST_INSERT_ID()
          &lt;/selectKey&gt;
    insert into Student (user_id,username,password,email) values (#{userId},#{username},#{password},#{email});
  &lt;/insert&gt;
</code></pre>

<table>
<thead>
<tr>
<th>order</th>
<th>This can be set to <code>BEFORE</code> or <code>AFTER</code>. If set to <code>BEFORE</code>, then it will select the key first, set the <code>keyProperty</code> and then execute the insert statement. If set to <code>AFTER</code>, it runs the insert statement and then the <code>selectKey</code> statement – which is common with databases like Oracle that may have embedded sequence calls inside of insert statements.</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="update">Update</h2>
<p>You should remember that if your entity's property is not set value, it will be set NULL value by default.So there has two solution:</p>
<ol>
<li>Select for result first, and then alter the new value. But it will be excute two sql statement.</li>
<li>Use Dynamic SQL. If the value is null, just don't update that column in your sql statement.</li>
</ol>
<h2 id="some-question-i-have-met">Some Question I have met</h2>
<ol>
<li>
<p>When I use Mybatis generator it throws a Exception, "The server time zone value '�й���׼ʱ��' is unrecognized or represents more than one time zone"</p>
</li>
<li>
<p>add <code>?serverTimezone=UTC</code> after your sql connect URL, such as </p>
</li>
</ol>
<pre><code class="java">connectionURL=&quot;jdbc:mysql://localhost:3306/homework?serverTimezone=UTC&quot;
</code></pre>

<ul>
<li>set your mysql's time zone(时区)</li>
</ul>
<p><code>set global time_zone='+8:00'</code></p>
<p>refers to <a href="https://www.cnblogs.com/shanelau/p/7041293.html"> l.shane</a></p>
<ol>
<li>
<p>When use generator could not generator correctly. It create a filed <code>currentConnections</code> that my table does not exists. The reason is that my table name called "users" or "user", just use another table name.</p>
</li>
<li>
<p>When you write SQL statement in mapper.xml, you should write its column name but not property name.</p>
</li>
</ol>
<h2 id="refers">Refers</h2>
<blockquote>
<p><a href="http://www.mybatis.org">www.mybatis.org</a></p>
<p><a href="http://www.mybatis.org/mybatis-3/">doc</a></p>
<p><a href="http://www.mybatis.org/mybatis-3/zh/index.html">doc.cn</a></p>
</blockquote>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../MySQL Notes/" class="btn btn-neutral float-right" title="MysqlNote">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../SpringMvc/" class="btn btn-neutral" title="SpringMVCNotes"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../SpringMvc/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../MySQL Notes/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>

</body>
</html>
